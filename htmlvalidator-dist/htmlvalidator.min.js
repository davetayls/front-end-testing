(function(){var l=this,o=l._,k={},f=Array.prototype,h=Object.prototype,b=f.slice,s=f.unshift,j=h.toString,i=h.hasOwnProperty,d=f.forEach,y=f.map,z=f.reduce,A=f.reduceRight,p=f.filter,B=f.every,r=f.some,n=f.indexOf,e=f.lastIndexOf,h=Array.isArray,E=Object.keys,v=Function.prototype.bind,c=function(a){return new t(a)};typeof module!=="undefined"&&module.exports?(module.exports=c,c._=c):l._=c;c.VERSION="1.1.7";var q=c.each=c.forEach=function(a,g,c){if(a!=null)if(d&&a.forEach===d)a.forEach(g,c);else if(a.length===
+a.length)for(var b=0,u=a.length;b<u;b++){if(b in a&&g.call(c,a[b],b,a)===k)break}else for(b in a)if(i.call(a,b)&&g.call(c,a[b],b,a)===k)break};c.map=function(a,g,c){var b=[];if(a==null)return b;if(y&&a.map===y)return a.map(g,c);q(a,function(a,d,e){b[b.length]=g.call(c,a,d,e)});return b};c.reduce=c.foldl=c.inject=function(a,g,m,b){var u=m!==void 0;a==null&&(a=[]);if(z&&a.reduce===z)return b&&(g=c.bind(g,b)),u?a.reduce(g,m):a.reduce(g);q(a,function(a,c,d){u?m=g.call(b,m,a,c,d):(m=a,u=!0)});if(!u)throw new TypeError("Reduce of empty array with no initial value");
return m};c.reduceRight=c.foldr=function(a,g,m,b){a==null&&(a=[]);if(A&&a.reduceRight===A)return b&&(g=c.bind(g,b)),m!==void 0?a.reduceRight(g,m):a.reduceRight(g);a=(c.isArray(a)?a.slice():c.toArray(a)).reverse();return c.reduce(a,g,m,b)};c.find=c.detect=function(a,g,c){var b;C(a,function(a,d,e){if(g.call(c,a,d,e))return b=a,!0});return b};c.filter=c.select=function(a,g,c){var b=[];if(a==null)return b;if(p&&a.filter===p)return a.filter(g,c);q(a,function(a,d,e){g.call(c,a,d,e)&&(b[b.length]=a)});return b};
c.reject=function(a,g,c){var b=[];if(a==null)return b;q(a,function(a,d,e){g.call(c,a,d,e)||(b[b.length]=a)});return b};c.every=c.all=function(a,g,c){var b=!0;if(a==null)return b;if(B&&a.every===B)return a.every(g,c);q(a,function(a,d,e){if(!(b=b&&g.call(c,a,d,e)))return k});return b};var C=c.some=c.any=function(a,g,b){var g=g||c.identity,w=!1;if(a==null)return w;if(r&&a.some===r)return a.some(g,b);q(a,function(a,c,d){if(w|=g.call(b,a,c,d))return k});return!!w};c.include=c.contains=function(a,g){var c=
!1;if(a==null)return c;if(n&&a.indexOf===n)return a.indexOf(g)!=-1;C(a,function(a){if(c=a===g)return!0});return c};c.invoke=function(a,g){var m=b.call(arguments,2);return c.map(a,function(a){return(g.call?g||a:a[g]).apply(a,m)})};c.pluck=function(a,g){return c.map(a,function(a){return a[g]})};c.max=function(a,g,b){if(!g&&c.isArray(a))return Math.max.apply(Math,a);var d={computed:-Infinity};q(a,function(a,c,e){c=g?g.call(b,a,c,e):a;c>=d.computed&&(d={value:a,computed:c})});return d.value};c.min=function(a,
g,b){if(!g&&c.isArray(a))return Math.min.apply(Math,a);var d={computed:Infinity};q(a,function(a,c,e){c=g?g.call(b,a,c,e):a;c<d.computed&&(d={value:a,computed:c})});return d.value};c.sortBy=function(a,g,b){return c.pluck(c.map(a,function(a,c,d){return{value:a,criteria:g.call(b,a,c,d)}}).sort(function(a,c){var g=a.criteria,b=c.criteria;return g<b?-1:g>b?1:0}),"value")};c.groupBy=function(a,c){var b={};q(a,function(a,d){var e=c(a,d);(b[e]||(b[e]=[])).push(a)});return b};c.sortedIndex=function(a,g,b){b||
(b=c.identity);for(var d=0,e=a.length;d<e;){var i=d+e>>1;b(a[i])<b(g)?d=i+1:e=i}return d};c.toArray=function(a){return!a?[]:a.toArray?a.toArray():c.isArray(a)?b.call(a):c.isArguments(a)?b.call(a):c.values(a)};c.size=function(a){return c.toArray(a).length};c.first=c.head=function(a,c,m){return c!=null&&!m?b.call(a,0,c):a[0]};c.rest=c.tail=function(a,c,m){return b.call(a,c==null||m?1:c)};c.last=function(a){return a[a.length-1]};c.compact=function(a){return c.filter(a,function(a){return!!a})};c.flatten=
function(a){return c.reduce(a,function(a,b){if(c.isArray(b))return a.concat(c.flatten(b));a[a.length]=b;return a},[])};c.without=function(a){return c.difference(a,b.call(arguments,1))};c.uniq=c.unique=function(a,b){return c.reduce(a,function(a,d,e){if(0==e||(b===!0?c.last(a)!=d:!c.include(a,d)))a[a.length]=d;return a},[])};c.union=function(){return c.uniq(c.flatten(arguments))};c.intersection=c.intersect=function(a){var g=b.call(arguments,1);return c.filter(c.uniq(a),function(a){return c.every(g,
function(b){return c.indexOf(b,a)>=0})})};c.difference=function(a,b){return c.filter(a,function(a){return!c.include(b,a)})};c.zip=function(){for(var a=b.call(arguments),g=c.max(c.pluck(a,"length")),m=Array(g),d=0;d<g;d++)m[d]=c.pluck(a,""+d);return m};c.indexOf=function(a,b,m){if(a==null)return-1;var d;if(m)return m=c.sortedIndex(a,b),a[m]===b?m:-1;if(n&&a.indexOf===n)return a.indexOf(b);m=0;for(d=a.length;m<d;m++)if(a[m]===b)return m;return-1};c.lastIndexOf=function(a,c){if(a==null)return-1;if(e&&
a.lastIndexOf===e)return a.lastIndexOf(c);for(var b=a.length;b--;)if(a[b]===c)return b;return-1};c.range=function(a,c,b){arguments.length<=1&&(c=a||0,a=0);for(var b=arguments[2]||1,d=Math.max(Math.ceil((c-a)/b),0),e=0,i=Array(d);e<d;)i[e++]=a,a+=b;return i};c.bind=function(a,c){if(a.bind===v&&v)return v.apply(a,b.call(arguments,1));var d=b.call(arguments,2);return function(){return a.apply(c,d.concat(b.call(arguments)))}};c.bindAll=function(a){var g=b.call(arguments,1);g.length==0&&(g=c.functions(a));
q(g,function(b){a[b]=c.bind(a[b],a)});return a};c.memoize=function(a,b){var d={};b||(b=c.identity);return function(){var c=b.apply(this,arguments);return i.call(d,c)?d[c]:d[c]=a.apply(this,arguments)}};c.delay=function(a,c){var d=b.call(arguments,2);return setTimeout(function(){return a.apply(a,d)},c)};c.defer=function(a){return c.delay.apply(c,[a,1].concat(b.call(arguments,1)))};var D=function(a,c,b){var d;return function(){var e=this,i=arguments,f=function(){d=null;a.apply(e,i)};b&&clearTimeout(d);
if(b||!d)d=setTimeout(f,c)}};c.throttle=function(a,c){return D(a,c,!1)};c.debounce=function(a,c){return D(a,c,!0)};c.once=function(a){var c=!1,b;return function(){if(c)return b;c=!0;return b=a.apply(this,arguments)}};c.wrap=function(a,c){return function(){var d=[a].concat(b.call(arguments));return c.apply(this,d)}};c.compose=function(){var a=b.call(arguments);return function(){for(var c=b.call(arguments),d=a.length-1;d>=0;d--)c=[a[d].apply(this,c)];return c[0]}};c.after=function(a,c){return function(){if(--a<
1)return c.apply(this,arguments)}};c.keys=E||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var c=[],b;for(b in a)i.call(a,b)&&(c[c.length]=b);return c};c.values=function(a){return c.map(a,c.identity)};c.functions=c.methods=function(a){var b=[],d;for(d in a)c.isFunction(a[d])&&b.push(d);return b.sort()};c.extend=function(a){q(b.call(arguments,1),function(c){for(var b in c)c[b]!==void 0&&(a[b]=c[b])});return a};c.defaults=function(a){q(b.call(arguments,1),function(c){for(var b in c)a[b]==
null&&(a[b]=c[b])});return a};c.clone=function(a){return c.isArray(a)?a.slice():c.extend({},a)};c.tap=function(a,c){c(a);return a};c.isEqual=function(a,b){if(a===b)return!0;var d=typeof a;if(d!=typeof b)return!1;if(a==b)return!0;if(!a&&b||a&&!b)return!1;if(a._chain)a=a._wrapped;if(b._chain)b=b._wrapped;if(a.isEqual)return a.isEqual(b);if(b.isEqual)return b.isEqual(a);if(c.isDate(a)&&c.isDate(b))return a.getTime()===b.getTime();if(c.isNaN(a)&&c.isNaN(b))return!1;if(c.isRegExp(a)&&c.isRegExp(b))return a.source===
b.source&&a.global===b.global&&a.ignoreCase===b.ignoreCase&&a.multiline===b.multiline;if(d!=="object")return!1;if(a.length&&a.length!==b.length)return!1;var d=c.keys(a),e=c.keys(b);if(d.length!=e.length)return!1;for(var i in a)if(!(i in b)||!c.isEqual(a[i],b[i]))return!1;return!0};c.isEmpty=function(a){if(c.isArray(a)||c.isString(a))return a.length===0;for(var b in a)if(i.call(a,b))return!1;return!0};c.isElement=function(a){return!!(a&&a.nodeType==1)};c.isArray=h||function(a){return j.call(a)==="[object Array]"};
c.isObject=function(a){return a===Object(a)};c.isArguments=function(a){return!(!a||!i.call(a,"callee"))};c.isFunction=function(a){return!(!a||!a.constructor||!a.call||!a.apply)};c.isString=function(a){return!!(a===""||a&&a.charCodeAt&&a.substr)};c.isNumber=function(a){return!!(a===0||a&&a.toExponential&&a.toFixed)};c.isNaN=function(a){return a!==a};c.isBoolean=function(a){return a===!0||a===!1};c.isDate=function(a){return!(!a||!a.getTimezoneOffset||!a.setUTCFullYear)};c.isRegExp=function(a){return!(!a||
!a.test||!a.exec||!(a.ignoreCase||a.ignoreCase===!1))};c.isNull=function(a){return a===null};c.isUndefined=function(a){return a===void 0};c.noConflict=function(){l._=o;return this};c.identity=function(a){return a};c.times=function(a,b,c){for(var d=0;d<a;d++)b.call(c,d)};c.mixin=function(a){q(c.functions(a),function(b){F(b,c[b]=a[b])})};var G=0;c.uniqueId=function(a){var b=G++;return a?a+b:b};c.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g};c.template=function(a,b){var d=
c.templateSettings,d="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+a.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(d.interpolate,function(a,b){return"',"+b.replace(/\\'/g,"'")+",'"}).replace(d.evaluate||null,function(a,b){return"');"+b.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",d=new Function("obj",d);return b?d(b):d};var t=function(a){this._wrapped=
a};c.prototype=t.prototype;var x=function(a,b){return b?c(a).chain():a},F=function(a,d){t.prototype[a]=function(){var a=b.call(arguments);s.call(a,this._wrapped);return x(d.apply(c,a),this._chain)}};c.mixin(c);q(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=f[a];t.prototype[a]=function(){b.apply(this._wrapped,arguments);return x(this._wrapped,this._chain)}});q(["concat","join","slice"],function(a){var b=f[a];t.prototype[a]=function(){return x(b.apply(this._wrapped,arguments),
this._chain)}});t.prototype.chain=function(){this._chain=!0;return this};t.prototype.value=function(){return this._wrapped}})();var JSON;JSON||(JSON={});
(function(){function l(b){return b<10?"0"+b:b}function o(b){h.lastIndex=0;return h.test(b)?'"'+b.replace(h,function(b){var d=j[b];return typeof d==="string"?d:"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+b+'"'}function k(d,f){var j,h,p,l,r=b,n,e=f[d];e&&typeof e==="object"&&typeof e.toJSON==="function"&&(e=e.toJSON(d));typeof i==="function"&&(e=i.call(f,d,e));switch(typeof e){case "string":return o(e);case "number":return isFinite(e)?String(e):"null";case "boolean":case "null":return String(e);
case "object":if(!e)return"null";b+=s;n=[];if(Object.prototype.toString.apply(e)==="[object Array]"){l=e.length;for(j=0;j<l;j+=1)n[j]=k(j,e)||"null";p=n.length===0?"[]":b?"[\n"+b+n.join(",\n"+b)+"\n"+r+"]":"["+n.join(",")+"]";b=r;return p}if(i&&typeof i==="object"){l=i.length;for(j=0;j<l;j+=1)typeof i[j]==="string"&&(h=i[j],(p=k(h,e))&&n.push(o(h)+(b?": ":":")+p))}else for(h in e)Object.prototype.hasOwnProperty.call(e,h)&&(p=k(h,e))&&n.push(o(h)+(b?": ":":")+p);p=n.length===0?"{}":b?"{\n"+b+n.join(",\n"+
b)+"\n"+r+"}":"{"+n.join(",")+"}";b=r;return p}}if(typeof Date.prototype.toJSON!=="function")Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+l(this.getUTCMonth()+1)+"-"+l(this.getUTCDate())+"T"+l(this.getUTCHours())+":"+l(this.getUTCMinutes())+":"+l(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var f=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
h=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,b,s,j={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},i;if(typeof JSON.stringify!=="function")JSON.stringify=function(d,j,f){var h;s=b="";if(typeof f==="number")for(h=0;h<f;h+=1)s+=" ";else typeof f==="string"&&(s=f);if((i=j)&&typeof j!=="function"&&(typeof j!=="object"||typeof j.length!=="number"))throw Error("JSON.stringify");return k("",
{"":d})};if(typeof JSON.parse!=="function")JSON.parse=function(b,i){function j(b,d){var f,h,e=b[d];if(e&&typeof e==="object")for(f in e)Object.prototype.hasOwnProperty.call(e,f)&&(h=j(e,f),h!==void 0?e[f]=h:delete e[f]);return i.call(b,d,e)}var h,b=String(b);f.lastIndex=0;f.test(b)&&(b=b.replace(f,function(b){return"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(b.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return h=eval("("+b+")"),typeof i==="function"?j({"":h},""):h;throw new SyntaxError("JSON.parse");}})();
(function(l){var o,k,f;if(typeof l.java!=="undefined")k=l.java,f=k.lang.System;var h={version:"@SJS_VERSION",fileSeparator:f?f.getProperty("file.separator"):"\\",args:function(){if(!o)if(k)o=new h.Args(l.arguments,"::");else if(ActiveXObject){var b=[],f;for(f=0;f<l.WSH.Arguments.length;f+=1)b.push(l.WSH.Arguments.Item(f));o=new h.Args(b,"::")}return o},file:function(b){return new h.io.File(b)},get:function(b){if(k)return readUrl(b);else if(WScript)throw"Sorry this is not implemented yet";},load:function(b){if(typeof load!==
"undefined")load(b);else if(typeof ActiveXObject!=="undefined")eval((new ActiveXObject("Scripting.FileSystemObject")).OpenTextFile(b,1).ReadAll());else throw"sjs is not compatible with this JavaScript engine";},print:function(b){typeof print!=="undefined"?print(b):l.WSH&&l.WSH.Echo(b)},workingDir:function(){if(k)return environment["user.dir"];else if(WScript)return WScript.CreateObject("WScript.Shell").CurrentDirectory}};l.sjs=h;h.Args=function(b,f){this.args={};var j=b.length,i;for(i=0;i<j;i+=1){var d=
b[i].split(f),k=this.args[d[0]];k||(k=new h.Arg(d[0]));k.addValue(d[1]);this.args[d[0]]||(this.args[d[0]]=k)}};h.Args.prototype={each:function(b){for(var f in this.args)if(b.call(this.args[f])===!1)break;return this},get:function(b){var f;this.each(function(){if(this.key===b)return f=this,!1});return f},getValue:function(b){return(b=this.get(b))?b.values:[]},getSingleValue:function(b){return(b=this.getValue(b)[0])&&b.length?b:""}};h.Arg=function(b){this.key=b;this.values=[]};h.Arg.prototype={addValue:function(b){this.values.push(b)},
join:function(b){return this.values.join(b)}};h.io={};h.io.File=function(b){if(k)this.javaFile=new k.io.File(b);this.path=b;this.contents=this.readText()};h.io.File.prototype={contents:null,path:"",append:function(b,f){if(typeof b==="number")return this.insertLine(b===0?0:b-1,f);else this.contents+=b;return this},clear:function(){this.contents="";return this},insertLine:function(b,f){var j=this.readText().split("\n");j.splice(b,0,f);this.contents=j.join("\n");return this},prepend:function(b){this.contents=
b+this.contents;return this},readText:function(b){var f;if(!this.contents||b)if(this.contents="",k){b=new k.io.FileReader(this.javaFile);for(b=new k.io.BufferedReader(b);f=b.readLine();)this.contents+=f+"\n"}else if(ActiveXObject)this.contents=(new ActiveXObject("Scripting.FileSystemObject")).OpenTextFile(this.path,1).ReadAll();return this.contents},save:function(b){if(typeof b==="string")this.path=b;if(k){if(typeof b==="string")this.javaFile=k.io.File(b);b=new k.io.FileWriter(this.javaFile,!1);b=
new k.io.BufferedWriter(b);b.write(this.contents);b.close()}else ActiveXObject&&(b=(new ActiveXObject("Scripting.FileSystemObject")).OpenTextFile(this.path,2,!0),b.Write(this.contents),b.Close());return this},text:function(b){this.contents=b;return this}}})(this);
(function(){var l=sjs.args().getSingleValue("debug")==="true",o=sjs.args().getSingleValue("url"),k=sjs.args().getSingleValue("config"),f,h={validatorHost:"validator.nu",validatorUrl:"http://<%= validatorHost %>/?level=error&out=json&doc=<%= url %>",whiteList:["Legacy doctype","xml:lang"],urls:[],errorTemplate:"<%= url %>|<%= lastLine %>|<%= message %>"},b=function(b,f){(l||f)&&sjs.print(b)};b("STARTING VALIDATOR");var s=function(j){var i=_.template(f.validatorUrl)({url:j,validatorHost:f.validatorHost}),
d,h="failed";b("Using validation url: "+i);b("Get url "+j);try{d=sjs.get(i)}catch(k){throw"There was a timeout while trying to reach the validator at this url "+i;}if(d){b("Got a result from "+j);d=JSON.parse(d);var h=d.url,j=d.messages,i=[],l,p,o,r,n;for(l=0;l<j.length;l++){n=!1;o=j[l];r=o.message;for(p=0;p<f.whiteList.length;p++){var e=f.whiteList[p];typeof e==="string"?r.indexOf(e)>=0&&(n=!0):e instanceof RegExp?e.test(r)&&(n=!0):typeof e==="function"&&(n=e.call(o,o))}n||(p=h,r=o,n=r.message.replace(RegExp(String.fromCharCode(226,
8364,339),"g"),'"').replace(RegExp(String.fromCharCode(226,8364,65533),"g"),'"'),e=_.template(f.errorTemplate),sjs.print(e({url:p,lastLine:r.lastLine,message:n})),i.push(o))}h=i.length===0?"passed":"failed";j="Validation for "+d.url+" has "+h;if(h==="failed")throw j;else b("OK    "+d.url,!0)}};(function(){var j,i,d;b("Initialising");if(o)b("Validating single url: "+o),s(o);else if(k){b("Loading from config "+k);j=sjs.file(k).readText();b("Loaded config:");b(j);f=j?_.extend({},h,JSON.parse(j)):void 0;
j=f.urls;for(d=0;d<j.length;d++)i=j[d],s(i)}sjs.print("HTML VALIDATION PASSED")})()})(this);
