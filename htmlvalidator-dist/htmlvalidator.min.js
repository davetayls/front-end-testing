(function(){var m=this,p=m._,j={},g=Array.prototype,h=Object.prototype,b=g.slice,r=g.unshift,k=h.toString,i=h.hasOwnProperty,d=g.forEach,y=g.map,z=g.reduce,A=g.reduceRight,o=g.filter,B=g.every,q=g.some,n=g.indexOf,e=g.lastIndexOf,h=Array.isArray,E=Object.keys,v=Function.prototype.bind,c=function(a){return new t(a)};typeof module!=="undefined"&&module.exports?(module.exports=c,c._=c):m._=c;c.VERSION="1.1.7";var s=c.each=c.forEach=function(a,f,c){if(a!=null)if(d&&a.forEach===d)a.forEach(f,c);else if(a.length===
+a.length)for(var b=0,u=a.length;b<u;b++){if(b in a&&f.call(c,a[b],b,a)===j)break}else for(b in a)if(i.call(a,b)&&f.call(c,a[b],b,a)===j)break};c.map=function(a,f,c){var b=[];if(a==null)return b;if(y&&a.map===y)return a.map(f,c);s(a,function(a,d,e){b[b.length]=f.call(c,a,d,e)});return b};c.reduce=c.foldl=c.inject=function(a,f,l,b){var u=l!==void 0;a==null&&(a=[]);if(z&&a.reduce===z)return b&&(f=c.bind(f,b)),u?a.reduce(f,l):a.reduce(f);s(a,function(a,c,d){u?l=f.call(b,l,a,c,d):(l=a,u=!0)});if(!u)throw new TypeError("Reduce of empty array with no initial value");
return l};c.reduceRight=c.foldr=function(a,f,l,b){a==null&&(a=[]);if(A&&a.reduceRight===A)return b&&(f=c.bind(f,b)),l!==void 0?a.reduceRight(f,l):a.reduceRight(f);a=(c.isArray(a)?a.slice():c.toArray(a)).reverse();return c.reduce(a,f,l,b)};c.find=c.detect=function(a,f,c){var b;C(a,function(a,d,e){if(f.call(c,a,d,e))return b=a,!0});return b};c.filter=c.select=function(a,f,c){var b=[];if(a==null)return b;if(o&&a.filter===o)return a.filter(f,c);s(a,function(a,d,e){f.call(c,a,d,e)&&(b[b.length]=a)});return b};
c.reject=function(a,f,c){var b=[];if(a==null)return b;s(a,function(a,d,e){f.call(c,a,d,e)||(b[b.length]=a)});return b};c.every=c.all=function(a,f,c){var b=!0;if(a==null)return b;if(B&&a.every===B)return a.every(f,c);s(a,function(a,d,e){if(!(b=b&&f.call(c,a,d,e)))return j});return b};var C=c.some=c.any=function(a,f,b){var f=f||c.identity,w=!1;if(a==null)return w;if(q&&a.some===q)return a.some(f,b);s(a,function(a,c,d){if(w|=f.call(b,a,c,d))return j});return!!w};c.include=c.contains=function(a,f){var c=
!1;if(a==null)return c;if(n&&a.indexOf===n)return a.indexOf(f)!=-1;C(a,function(a){if(c=a===f)return!0});return c};c.invoke=function(a,f){var l=b.call(arguments,2);return c.map(a,function(a){return(f.call?f||a:a[f]).apply(a,l)})};c.pluck=function(a,f){return c.map(a,function(a){return a[f]})};c.max=function(a,f,b){if(!f&&c.isArray(a))return Math.max.apply(Math,a);var d={computed:-Infinity};s(a,function(a,c,e){c=f?f.call(b,a,c,e):a;c>=d.computed&&(d={value:a,computed:c})});return d.value};c.min=function(a,
f,b){if(!f&&c.isArray(a))return Math.min.apply(Math,a);var d={computed:Infinity};s(a,function(a,c,e){c=f?f.call(b,a,c,e):a;c<d.computed&&(d={value:a,computed:c})});return d.value};c.sortBy=function(a,f,b){return c.pluck(c.map(a,function(a,c,d){return{value:a,criteria:f.call(b,a,c,d)}}).sort(function(a,c){var f=a.criteria,b=c.criteria;return f<b?-1:f>b?1:0}),"value")};c.groupBy=function(a,c){var b={};s(a,function(a,d){var e=c(a,d);(b[e]||(b[e]=[])).push(a)});return b};c.sortedIndex=function(a,f,b){b||
(b=c.identity);for(var d=0,e=a.length;d<e;){var i=d+e>>1;b(a[i])<b(f)?d=i+1:e=i}return d};c.toArray=function(a){return!a?[]:a.toArray?a.toArray():c.isArray(a)?b.call(a):c.isArguments(a)?b.call(a):c.values(a)};c.size=function(a){return c.toArray(a).length};c.first=c.head=function(a,c,l){return c!=null&&!l?b.call(a,0,c):a[0]};c.rest=c.tail=function(a,c,l){return b.call(a,c==null||l?1:c)};c.last=function(a){return a[a.length-1]};c.compact=function(a){return c.filter(a,function(a){return!!a})};c.flatten=
function(a){return c.reduce(a,function(a,b){if(c.isArray(b))return a.concat(c.flatten(b));a[a.length]=b;return a},[])};c.without=function(a){return c.difference(a,b.call(arguments,1))};c.uniq=c.unique=function(a,b){return c.reduce(a,function(a,d,e){if(0==e||(b===!0?c.last(a)!=d:!c.include(a,d)))a[a.length]=d;return a},[])};c.union=function(){return c.uniq(c.flatten(arguments))};c.intersection=c.intersect=function(a){var f=b.call(arguments,1);return c.filter(c.uniq(a),function(a){return c.every(f,
function(b){return c.indexOf(b,a)>=0})})};c.difference=function(a,b){return c.filter(a,function(a){return!c.include(b,a)})};c.zip=function(){for(var a=b.call(arguments),f=c.max(c.pluck(a,"length")),l=Array(f),d=0;d<f;d++)l[d]=c.pluck(a,""+d);return l};c.indexOf=function(a,b,l){if(a==null)return-1;var d;if(l)return l=c.sortedIndex(a,b),a[l]===b?l:-1;if(n&&a.indexOf===n)return a.indexOf(b);l=0;for(d=a.length;l<d;l++)if(a[l]===b)return l;return-1};c.lastIndexOf=function(a,c){if(a==null)return-1;if(e&&
a.lastIndexOf===e)return a.lastIndexOf(c);for(var b=a.length;b--;)if(a[b]===c)return b;return-1};c.range=function(a,c,b){arguments.length<=1&&(c=a||0,a=0);for(var b=arguments[2]||1,d=Math.max(Math.ceil((c-a)/b),0),e=0,i=Array(d);e<d;)i[e++]=a,a+=b;return i};c.bind=function(a,c){if(a.bind===v&&v)return v.apply(a,b.call(arguments,1));var d=b.call(arguments,2);return function(){return a.apply(c,d.concat(b.call(arguments)))}};c.bindAll=function(a){var f=b.call(arguments,1);f.length==0&&(f=c.functions(a));
s(f,function(b){a[b]=c.bind(a[b],a)});return a};c.memoize=function(a,b){var d={};b||(b=c.identity);return function(){var c=b.apply(this,arguments);return i.call(d,c)?d[c]:d[c]=a.apply(this,arguments)}};c.delay=function(a,c){var d=b.call(arguments,2);return setTimeout(function(){return a.apply(a,d)},c)};c.defer=function(a){return c.delay.apply(c,[a,1].concat(b.call(arguments,1)))};var D=function(a,c,b){var d;return function(){var e=this,i=arguments,j=function(){d=null;a.apply(e,i)};b&&clearTimeout(d);
if(b||!d)d=setTimeout(j,c)}};c.throttle=function(a,c){return D(a,c,!1)};c.debounce=function(a,c){return D(a,c,!0)};c.once=function(a){var c=!1,b;return function(){if(c)return b;c=!0;return b=a.apply(this,arguments)}};c.wrap=function(a,c){return function(){var d=[a].concat(b.call(arguments));return c.apply(this,d)}};c.compose=function(){var a=b.call(arguments);return function(){for(var c=b.call(arguments),d=a.length-1;d>=0;d--)c=[a[d].apply(this,c)];return c[0]}};c.after=function(a,c){return function(){if(--a<
1)return c.apply(this,arguments)}};c.keys=E||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var c=[],b;for(b in a)i.call(a,b)&&(c[c.length]=b);return c};c.values=function(a){return c.map(a,c.identity)};c.functions=c.methods=function(a){var b=[],d;for(d in a)c.isFunction(a[d])&&b.push(d);return b.sort()};c.extend=function(a){s(b.call(arguments,1),function(c){for(var b in c)c[b]!==void 0&&(a[b]=c[b])});return a};c.defaults=function(a){s(b.call(arguments,1),function(c){for(var b in c)a[b]==
null&&(a[b]=c[b])});return a};c.clone=function(a){return c.isArray(a)?a.slice():c.extend({},a)};c.tap=function(a,c){c(a);return a};c.isEqual=function(a,b){if(a===b)return!0;var d=typeof a;if(d!=typeof b)return!1;if(a==b)return!0;if(!a&&b||a&&!b)return!1;if(a._chain)a=a._wrapped;if(b._chain)b=b._wrapped;if(a.isEqual)return a.isEqual(b);if(b.isEqual)return b.isEqual(a);if(c.isDate(a)&&c.isDate(b))return a.getTime()===b.getTime();if(c.isNaN(a)&&c.isNaN(b))return!1;if(c.isRegExp(a)&&c.isRegExp(b))return a.source===
b.source&&a.global===b.global&&a.ignoreCase===b.ignoreCase&&a.multiline===b.multiline;if(d!=="object")return!1;if(a.length&&a.length!==b.length)return!1;var d=c.keys(a),e=c.keys(b);if(d.length!=e.length)return!1;for(var i in a)if(!(i in b)||!c.isEqual(a[i],b[i]))return!1;return!0};c.isEmpty=function(a){if(c.isArray(a)||c.isString(a))return a.length===0;for(var b in a)if(i.call(a,b))return!1;return!0};c.isElement=function(a){return!!(a&&a.nodeType==1)};c.isArray=h||function(a){return k.call(a)==="[object Array]"};
c.isObject=function(a){return a===Object(a)};c.isArguments=function(a){return!(!a||!i.call(a,"callee"))};c.isFunction=function(a){return!(!a||!a.constructor||!a.call||!a.apply)};c.isString=function(a){return!!(a===""||a&&a.charCodeAt&&a.substr)};c.isNumber=function(a){return!!(a===0||a&&a.toExponential&&a.toFixed)};c.isNaN=function(a){return a!==a};c.isBoolean=function(a){return a===!0||a===!1};c.isDate=function(a){return!(!a||!a.getTimezoneOffset||!a.setUTCFullYear)};c.isRegExp=function(a){return!(!a||
!a.test||!a.exec||!(a.ignoreCase||a.ignoreCase===!1))};c.isNull=function(a){return a===null};c.isUndefined=function(a){return a===void 0};c.noConflict=function(){m._=p;return this};c.identity=function(a){return a};c.times=function(a,b,c){for(var d=0;d<a;d++)b.call(c,d)};c.mixin=function(a){s(c.functions(a),function(b){F(b,c[b]=a[b])})};var G=0;c.uniqueId=function(a){var b=G++;return a?a+b:b};c.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g};c.template=function(a,b){var d=
c.templateSettings,d="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+a.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(d.interpolate,function(a,b){return"',"+b.replace(/\\'/g,"'")+",'"}).replace(d.evaluate||null,function(a,b){return"');"+b.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",d=new Function("obj",d);return b?d(b):d};var t=function(a){this._wrapped=
a};c.prototype=t.prototype;var x=function(a,b){return b?c(a).chain():a},F=function(a,d){t.prototype[a]=function(){var a=b.call(arguments);r.call(a,this._wrapped);return x(d.apply(c,a),this._chain)}};c.mixin(c);s(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=g[a];t.prototype[a]=function(){b.apply(this._wrapped,arguments);return x(this._wrapped,this._chain)}});s(["concat","join","slice"],function(a){var b=g[a];t.prototype[a]=function(){return x(b.apply(this._wrapped,arguments),
this._chain)}});t.prototype.chain=function(){this._chain=!0;return this};t.prototype.value=function(){return this._wrapped}})();var JSON;JSON||(JSON={});
(function(){function m(b){return b<10?"0"+b:b}function p(b){h.lastIndex=0;return h.test(b)?'"'+b.replace(h,function(b){var d=k[b];return typeof d==="string"?d:"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+b+'"'}function j(d,g){var k,h,o,m,q=b,n,e=g[d];e&&typeof e==="object"&&typeof e.toJSON==="function"&&(e=e.toJSON(d));typeof i==="function"&&(e=i.call(g,d,e));switch(typeof e){case "string":return p(e);case "number":return isFinite(e)?String(e):"null";case "boolean":case "null":return String(e);
case "object":if(!e)return"null";b+=r;n=[];if(Object.prototype.toString.apply(e)==="[object Array]"){m=e.length;for(k=0;k<m;k+=1)n[k]=j(k,e)||"null";o=n.length===0?"[]":b?"[\n"+b+n.join(",\n"+b)+"\n"+q+"]":"["+n.join(",")+"]";b=q;return o}if(i&&typeof i==="object"){m=i.length;for(k=0;k<m;k+=1)typeof i[k]==="string"&&(h=i[k],(o=j(h,e))&&n.push(p(h)+(b?": ":":")+o))}else for(h in e)Object.prototype.hasOwnProperty.call(e,h)&&(o=j(h,e))&&n.push(p(h)+(b?": ":":")+o);o=n.length===0?"{}":b?"{\n"+b+n.join(",\n"+
b)+"\n"+q+"}":"{"+n.join(",")+"}";b=q;return o}}if(typeof Date.prototype.toJSON!=="function")Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+m(this.getUTCMonth()+1)+"-"+m(this.getUTCDate())+"T"+m(this.getUTCHours())+":"+m(this.getUTCMinutes())+":"+m(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var g=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
h=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,b,r,k={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},i;if(typeof JSON.stringify!=="function")JSON.stringify=function(d,k,g){var h;r=b="";if(typeof g==="number")for(h=0;h<g;h+=1)r+=" ";else typeof g==="string"&&(r=g);if((i=k)&&typeof k!=="function"&&(typeof k!=="object"||typeof k.length!=="number"))throw Error("JSON.stringify");return j("",
{"":d})};if(typeof JSON.parse!=="function")JSON.parse=function(b,i){function k(b,d){var h,g,e=b[d];if(e&&typeof e==="object")for(h in e)Object.prototype.hasOwnProperty.call(e,h)&&(g=k(e,h),g!==void 0?e[h]=g:delete e[h]);return i.call(b,d,e)}var h,b=String(b);g.lastIndex=0;g.test(b)&&(b=b.replace(g,function(b){return"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(b.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return h=eval("("+b+")"),typeof i==="function"?k({"":h},""):h;throw new SyntaxError("JSON.parse");}})();
(function(m){var p,j,g;if(typeof m.java!=="undefined")j=m.java,g=j.lang.System;var h={version:"@SJS_VERSION",fileSeparator:g?g.getProperty("file.separator"):"\\",args:function(){if(!p)if(j)p=new h.Args(m.arguments,"::");else if(ActiveXObject){var b=[],g;for(g=0;g<m.WSH.Arguments.length;g+=1)b.push(m.WSH.Arguments.Item(g));p=new h.Args(b,"::")}return p},file:function(b){return new h.io.File(b)},get:function(b){if(j)return readUrl(b);else if(WScript)throw"Sorry this is not implemented yet";},load:function(b){if(typeof load!==
"undefined")load(b);else if(typeof ActiveXObject!=="undefined")eval((new ActiveXObject("Scripting.FileSystemObject")).OpenTextFile(b,1).ReadAll());else throw"sjs is not compatible with this JavaScript engine";},print:function(b){typeof print!=="undefined"?print(b):m.WSH&&m.WSH.Echo(b)},workingDir:function(){if(j)return environment["user.dir"];else if(WScript)return WScript.CreateObject("WScript.Shell").CurrentDirectory}};m.sjs=h;h.Args=function(b,g){this.args={};var k=b.length,i;for(i=0;i<k;i+=1){var d=
b[i].split(g),j=this.args[d[0]];j||(j=new h.Arg(d[0]));j.addValue(d[1]);this.args[d[0]]||(this.args[d[0]]=j)}};h.Args.prototype={each:function(b){for(var g in this.args)if(b.call(this.args[g])===!1)break;return this},get:function(b){var g;this.each(function(){if(this.key===b)return g=this,!1});return g},getValue:function(b){return(b=this.get(b))?b.values:[]},getSingleValue:function(b){return(b=this.getValue(b)[0])&&b.length?b:""}};h.Arg=function(b){this.key=b;this.values=[]};h.Arg.prototype={addValue:function(b){this.values.push(b)},
join:function(b){return this.values.join(b)}};h.io={};h.io.File=function(b){if(j)this.javaFile=new j.io.File(b);this.path=b;this.contents=this.readText()};h.io.File.prototype={contents:null,path:"",append:function(b,g){if(typeof b==="number")return this.insertLine(b===0?0:b-1,g);else this.contents+=b;return this},clear:function(){this.contents="";return this},insertLine:function(b,g){var k=this.readText().split("\n");k.splice(b,0,g);this.contents=k.join("\n");return this},prepend:function(b){this.contents=
b+this.contents;return this},readText:function(b){var g;if(!this.contents||b)if(this.contents="",j){b=new j.io.FileReader(this.javaFile);for(b=new j.io.BufferedReader(b);g=b.readLine();)this.contents+=g+"\n"}else if(ActiveXObject)this.contents=(new ActiveXObject("Scripting.FileSystemObject")).OpenTextFile(this.path,1).ReadAll();return this.contents},save:function(b){if(typeof b==="string")this.path=b;if(j){if(typeof b==="string")this.javaFile=j.io.File(b);b=new j.io.FileWriter(this.javaFile,!1);b=
new j.io.BufferedWriter(b);b.write(this.contents);b.close()}else ActiveXObject&&(b=(new ActiveXObject("Scripting.FileSystemObject")).OpenTextFile(this.path,2,!0),b.Write(this.contents),b.Close());return this},text:function(b){this.contents=b;return this}}})(this);
(function(){var m=sjs.args().getSingleValue("debug")==="true",p=sjs.args().getSingleValue("url"),j=sjs.args().getSingleValue("config"),g,h={validatorHost:"validator.nu",validatorUrl:"http://<%= validatorHost %>/?level=error&out=json&doc=<%= url %>",whiteList:["Legacy doctype","xml:lang"],urls:[]},b=function(b,g){(m||g)&&sjs.print(b)};b("STARTING VALIDATOR");var r=function(h){var i=_.template(g.validatorUrl)({url:h,validatorHost:g.validatorHost}),d,j="failed";b("Using validation url: "+i);b("Get url "+
h);try{d=sjs.get(i)}catch(m){throw"There was a timeout while trying to reach the validator at this url "+i;}if(d){b("Got a result from "+h);d=JSON.parse(d);var j=d.url,h=d.messages,i=[],p,o,r,q,n;for(p=0;p<h.length;p++){n=!1;r=h[p];q=r.message;for(o=0;o<g.whiteList.length;o++){var e=g.whiteList[o];typeof e==="string"?q.indexOf(e)>=0&&(n=!0):e instanceof RegExp?e.test(q)&&(n=!0):typeof e==="function"&&(n=e.call(r,r))}n||(o=j,q=r,n=q.message.replace(RegExp(String.fromCharCode(226,8364,339),"g"),'"').replace(RegExp(String.fromCharCode(226,
8364,65533),"g"),'"'),sjs.print(o+"|"+q.lastLine+"| "+n),o=q.message.charCodeAt(19),q=String.fromCharCode(o),sjs.print(o+" "+q),i.push(r))}j=i.length===0?"passed":"failed";h="Validation for "+d.url+" has "+j;if(j==="failed")throw h;else b("OK    "+d.url,!0)}};(function(){var k,i,d;b("Initialising");if(p)b("Validating single url: "+p),r(p);else if(j){b("Loading from config "+j);k=sjs.file(j).readText();b("Loaded config:");b(k);g=k?_.extend({},h,JSON.parse(k)):void 0;k=g.urls;for(d=0;d<k.length;d++)i=
k[d],r(i)}sjs.print("HTML VALIDATION PASSED")})()})(this);
