var JSON;JSON||(JSON={});
(function(){function e(a){return a<10?"0"+a:a}function k(a){d.lastIndex=0;return d.test(a)?'"'+a.replace(d,function(a){var b=h[a];return typeof b==="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function c(o,i){var j,g,l,d,e=a,h,f=i[o];f&&typeof f==="object"&&typeof f.toJSON==="function"&&(f=f.toJSON(o));typeof n==="function"&&(f=n.call(i,o,f));switch(typeof f){case "string":return k(f);case "number":return isFinite(f)?String(f):"null";case "boolean":case "null":return String(f);case "object":if(!f)return"null";
a+=b;h=[];if(Object.prototype.toString.apply(f)==="[object Array]"){d=f.length;for(j=0;j<d;j+=1)h[j]=c(j,f)||"null";l=h.length===0?"[]":a?"[\n"+a+h.join(",\n"+a)+"\n"+e+"]":"["+h.join(",")+"]";a=e;return l}if(n&&typeof n==="object"){d=n.length;for(j=0;j<d;j+=1)typeof n[j]==="string"&&(g=n[j],(l=c(g,f))&&h.push(k(g)+(a?": ":":")+l))}else for(g in f)Object.prototype.hasOwnProperty.call(f,g)&&(l=c(g,f))&&h.push(k(g)+(a?": ":":")+l);l=h.length===0?"{}":a?"{\n"+a+h.join(",\n"+a)+"\n"+e+"}":"{"+h.join(",")+
"}";a=e;return l}}if(typeof Date.prototype.toJSON!=="function")Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var m=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
d=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,a,b,h={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},n;if(typeof JSON.stringify!=="function")JSON.stringify=function(h,i,j){var g;b=a="";if(typeof j==="number")for(g=0;g<j;g+=1)b+=" ";else typeof j==="string"&&(b=j);if((n=i)&&typeof i!=="function"&&(typeof i!=="object"||typeof i.length!=="number"))throw Error("JSON.stringify");return c("",
{"":h})};if(typeof JSON.parse!=="function")JSON.parse=function(a,b){function h(a,g){var d,c,f=a[g];if(f&&typeof f==="object")for(d in f)Object.prototype.hasOwnProperty.call(f,d)&&(c=h(f,d),c!==void 0?f[d]=c:delete f[d]);return b.call(a,g,f)}var g,a=String(a);m.lastIndex=0;m.test(a)&&(a=a.replace(m,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return g=eval("("+a+")"),typeof b==="function"?h({"":g},""):g;throw new SyntaxError("JSON.parse");}})();
(function(e){var k,c,m;if(typeof e.java!=="undefined")c=e.java,m=c.lang.System;var d={version:"@SJS_VERSION",fileSeparator:m?m.getProperty("file.separator"):"\\",args:function(){if(!k)if(c)k=new d.Args(e.arguments,"::");else if(ActiveXObject){var a=[],b;for(b=0;b<e.WSH.Arguments.length;b+=1)a.push(e.WSH.Arguments.Item(b));k=new d.Args(a,"::")}return k},file:function(a){return new d.io.File(a)},get:function(a){if(c)return readUrl(a);else if(WScript)throw"Sorry this is not implemented yet";},load:function(a){if(typeof load!==
"undefined")load(a);else if(typeof ActiveXObject!=="undefined")eval((new ActiveXObject("Scripting.FileSystemObject")).OpenTextFile(a,1).ReadAll());else throw"sjs is not compatible with this JavaScript engine";},print:function(a){typeof print!=="undefined"?print(a):e.WSH&&e.WSH.Echo(a)},workingDir:function(){if(c)return environment["user.dir"];else if(WScript)return WScript.CreateObject("WScript.Shell").CurrentDirectory}};e.sjs=d;d.Args=function(a,b){this.args={};var h=a.length,c;for(c=0;c<h;c+=1){var e=
a[c].split(b),i=this.args[e[0]];i||(i=new d.Arg(e[0]));i.addValue(e[1]);this.args[e[0]]||(this.args[e[0]]=i)}};d.Args.prototype={each:function(a){for(var b in this.args)if(a.call(this.args[b])===!1)break;return this},get:function(a){var b;this.each(function(){if(this.key===a)return b=this,!1});return b},getValue:function(a){return this.get(a).values},getSingleValue:function(a){if((a=this.getValue(a)[0])&&a.length)return a}};d.Arg=function(a){this.key=a;this.values=[]};d.Arg.prototype={addValue:function(a){this.values.push(a)},
join:function(a){return this.values.join(a)}};d.io={};d.io.File=function(a){if(c)this.javaFile=new c.io.File(a);this.path=a;this.contents=this.readText()};d.io.File.prototype={contents:null,path:"",append:function(a,b){if(typeof a==="number")return this.insertLine(a===0?0:a-1,b);else this.contents+=a;return this},clear:function(){this.contents="";return this},insertLine:function(a,b){var c=this.readText().split("\n");c.splice(a,0,b);this.contents=c.join("\n");return this},prepend:function(a){this.contents=
a+this.contents;return this},readText:function(a){var b;if(!this.contents||a)if(this.contents="",c){a=new c.io.FileReader(this.javaFile);for(a=new c.io.BufferedReader(a);b=a.readLine();)this.contents+=b+"\n"}else if(ActiveXObject)this.contents=(new ActiveXObject("Scripting.FileSystemObject")).OpenTextFile(this.path,1).ReadAll();return this.contents},save:function(a){if(typeof a==="string")this.path=a;if(c){if(typeof a==="string")this.javaFile=c.io.File(a);a=new c.io.FileWriter(this.javaFile,!1);a=
new c.io.BufferedWriter(a);a.write(this.contents);a.close()}else ActiveXObject&&(a=(new ActiveXObject("Scripting.FileSystemObject")).OpenTextFile(this.path,2,!0),a.Write(this.contents),a.Close());return this},text:function(a){this.contents=a;return this}}})(this);
(function(){var e=sjs.args().getSingleValue("debug")==="true",k=sjs.args().getSingleValue("url"),c=sjs.args().getSingleValue("config"),m=["Legacy doctype"],d=function(a){var b="failed";if(a=sjs.get("http://testing.local:8888/?level=error&out=json&doc=${url}".replace("${url}",a))){var a=JSON.parse(a),b=a.url,c=a.messages,d=[],e,i,j,g,l;for(e=0;e<c.length;e++){l=!1;j=c[e];g=j.message;for(i=0;i<m.length;i++){var k=m[i];typeof k==="string"?g.indexOf(k)>=0&&(l=!0):k instanceof RegExp?k.test(g)&&(l=!0):
typeof k==="function"&&(l=k.call(j,j))}l||(i=b,g=j,l=g.message.replace(RegExp(String.fromCharCode(226,8364,339),"g"),'"').replace(RegExp(String.fromCharCode(226,8364,65533),"g"),'"'),sjs.print(i+"|"+g.lastLine+"| "+l),i=g.message.charCodeAt(19),g=String.fromCharCode(i),sjs.print(i+" "+g),d.push(j))}b=d.length===0?"passed":"failed";a="Validation for "+a.url+" has "+b;if(b==="failed")throw a;}};(function(){var a,b,h;if(k)d(k);else if(c){a=sjs.file(c).readText();e&&(sjs.print("Loaded config:"),sjs.print(a));
a=a?JSON.parse(a):void 0;m=a.whiteList;a=a.urls;for(h=0;h<a.length;h++)b=a[h],d(b)}sjs.print("HTML VALIDATION PASSED")})()})(this);
